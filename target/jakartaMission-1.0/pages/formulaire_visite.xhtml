<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:p="http://xmlns.jcp.org/jsf/passthrough">

    <h:head>
        <title>Formulaire de Visite</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
    </h:head>

    <f:metadata>
        <f:viewParam name="lieuId" value="#{visiteBean.lieuId}" />
    </f:metadata>

    <h:body class="bg-light">

        <nav class="navbar navbar-expand-lg navbar-dark bg-danger">
            <div class="container">
                <a class="navbar-brand fw-bold" href="#">UDBL - Gestion des Missions</a>
                <div class="navbar-nav">
                    <h:link outcome="visite" value="Retour à l'historique" styleClass="nav-link" />
                </div>
            </div>
        </nav>

        <div class="container mt-5">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="card shadow p-4">
                        <h2 class="mb-4 text-danger border-bottom pb-2">Enregistrer une nouvelle visite</h2>

                        <h:messages globalOnly="true" 
                                    infoClass="alert alert-success" 
                                    errorClass="alert alert-danger"
                                    style="list-style: none; padding: 0;" />

                        <h:form id="visiteForm">
                            <div class="mb-4">
                                <label for="lieuId" class="form-label fw-bold">Lieu visité</label>
                                <h:selectOneMenu id="lieuId" value="#{visiteBean.lieuId}" 
                                                 styleClass="form-select" required="true"
                                                 requiredMessage="Veuillez sélectionner un lieu.">
                                    <f:selectItem itemLabel="-- Choisir un lieu --" itemValue="" noSelectionOption="true" />
                                    <f:selectItems value="#{lieuBean.lieux}" var="l" 
                                                   itemValue="#{l.id}" itemLabel="#{l.nom}" />
                                </h:selectOneMenu>
                                <h:message for="lieuId" styleClass="text-danger small" />
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="tempsPasse" class="form-label fw-bold">Durée (heures)</label>
                                    <h:inputText id="tempsPasse" value="#{visiteBean.tempsPasse}" 
                                                 styleClass="form-control" p:type="number" p:step="0.5">
                                    </h:inputText>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label for="depense" class="form-label fw-bold">Budget dépensé ($)</label>
                                    <div class="input-group">
                                        <h:inputText id="depense" value="#{visiteBean.depense}" 
                                                     styleClass="form-control" p:type="number" p:step="0.01">
                                        </h:inputText>
                                        <span class="input-group-text">$</span>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label for="observation" class="form-label fw-bold">Observations de mission</label>
                                <h:inputTextarea id="observation" value="#{visiteBean.observation}" 
                                                 styleClass="form-control" rows="4" 
                                                 p:placeholder="Décrivez le déroulement de votre visite..." />
                            </div>

                            <div class="d-flex gap-2 pt-3 border-top">
                                <h:commandButton value="Enregistrer la visite" 
                                                 action="#{visiteBean.enregistrerVisite}"
                                                 styleClass="btn btn-danger btn-lg px-4" />
                                
                                <h:commandButton value="Annuler" 
                                                 action="visite?faces-redirect=true" 
                                                 immediate="true"
                                                 styleClass="btn btn-outline-secondary btn-lg px-4" />
                            </div>
                        </h:form>
                    </div>
                </div>
            </div>
        </div>

        <footer class="text-center mt-5 text-muted small">
            &copy; 2026 UDBL Jakarta Mission - Système de suivi
        </footer>

    </h:body>
</html>